<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Client</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <style>
      html,
      body {
        background: #333;
      }
    </style>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
      var accessToken =
        location.href.match(/access_token=([^\&]+)/)?.[1] ||
        localStorage.getItem("at");
      localStorage.setItem("at", accessToken);
      console.log({ accessToken });
      window.onSpotifyWebPlaybackSDKReady = () => {
        const token = accessToken;
        const player = new Spotify.Player({
          name: "Web Playback SDK Quick Start Player",
          getOAuthToken: (cb) => {
            cb(token);
          },
        });

        window.player = player;

        // Ready
        player.addListener("ready", ({ device_id }) => {
          console.log("Ready with Device ID", device_id);
          fetch("https://api.spotify.com/v1/me/player", {
            method: "put",
            headers: { Authorization: `Bearer ${accessToken}` },
            body: JSON.stringify({ device_ids: [device_id], play: true }),
          }).then(async (res) => {
            // console.log(await res.json());
          });
        });

        // Connect to the player!
        player.connect();
      };

      fetch("https://api.spotify.com/v1/tracks/11dFghVXANMlKmJXsNCbNl", {
        headers: { Authorization: `Bearer ${accessToken}` },
      }).then(async (res) => {
        console.log(await res.json());
      });
    </script>
  </head>

  <body>
    <app-root></app-root>
  </body>
</html>
